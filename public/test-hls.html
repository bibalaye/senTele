<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test HLS.js</title>
    <script src="https://cdn.jsdelivr.net/npm/hls.js@1.5.15/dist/hls.min.js"></script>
    <style>
        body {
            margin: 0;
            padding: 20px;
            background: #000;
            color: #fff;
            font-family: Arial, sans-serif;
        }

        video {
            width: 100%;
            max-width: 800px;
            display: block;
            margin: 20px auto;
        }

        .info {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: #222;
            border-radius: 8px;
        }

        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
        }

        .success {
            background: #0a0;
            color: #fff;
        }

        .error {
            background: #a00;
            color: #fff;
        }

        .warning {
            background: #aa0;
            color: #000;
        }

        input {
            width: 100%;
            padding: 10px;
            margin: 10px 0;
            background: #333;
            border: 1px solid #555;
            color: #fff;
            border-radius: 4px;
        }

        button {
            padding: 10px 20px;
            background: #0066cc;
            color: #fff;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }

        button:hover {
            background: #0052a3;
        }
    </style>
</head>

<body>
    <div class="info">
        <h1>üé¨ Test HLS.js Player</h1>
        <p>Testez votre flux HLS ici</p>

        <div id="status"></div>

        <label for="streamUrl">URL du flux HLS (.m3u8):</label>
        <input type="text" id="streamUrl" placeholder="https://example.com/stream.m3u8"
            value="https://test-streams.mux.dev/x36xhzz/x36xhzz.m3u8">
        <button onclick="loadStream()">Charger le flux</button>
    </div>

    <video id="video" controls></video>

    <div class="info">
        <h3>Logs:</h3>
        <div id="logs" style="font-family: monospace; font-size: 12px;"></div>
    </div>

    <script>
        const video = document.getElementById('video');
        const statusDiv = document.getElementById('status');
        const logsDiv = document.getElementById('logs');
        let hls = null;

        function log(message, type = 'info') {
            const time = new Date().toLocaleTimeString();
            const logEntry = document.createElement('div');
            logEntry.textContent = `[${time}] ${message}`;
            logEntry.style.color = type === 'error' ? '#f00' : type === 'success' ? '#0f0' : '#fff';
            logsDiv.appendChild(logEntry);
            logsDiv.scrollTop = logsDiv.scrollHeight;
            console.log(message);
        }

        function showStatus(message, type) {
            statusDiv.innerHTML = `<div class="status ${type}">${message}</div>`;
        }

        function loadStream() {
            const streamUrl = document.getElementById('streamUrl').value;

            if (!streamUrl) {
                showStatus('‚ùå Veuillez entrer une URL de flux', 'error');
                return;
            }

            log('üé¨ Chargement du flux: ' + streamUrl);
            showStatus('‚è≥ Chargement...', 'warning');

            // Cleanup previous instance
            if (hls) {
                log('üßπ Nettoyage de l\'instance pr√©c√©dente');
                hls.destroy();
            }

            // Check HLS.js support
            if (typeof Hls === 'undefined') {
                showStatus('‚ùå HLS.js n\'est pas charg√©', 'error');
                log('‚ùå HLS.js not loaded', 'error');
                return;
            }

            log('‚úÖ HLS.js version: ' + Hls.version, 'success');

            if (Hls.isSupported()) {
                log('‚úÖ HLS.js est support√©', 'success');
                showStatus('‚úÖ HLS.js support√©, initialisation...', 'success');

                hls = new Hls({
                    debug: true,
                    enableWorker: true,
                    lowLatencyMode: true
                });

                hls.loadSource(streamUrl);
                hls.attachMedia(video);

                hls.on(Hls.Events.MANIFEST_PARSED, function () {
                    log('‚úÖ Manifest pars√© avec succ√®s', 'success');
                    showStatus('‚úÖ Flux charg√© avec succ√®s!', 'success');
                    video.play().catch(err => {
                        log('‚ö†Ô∏è Autoplay bloqu√©: ' + err.message, 'error');
                        showStatus('‚ö†Ô∏è Cliquez sur play pour d√©marrer', 'warning');
                    });
                });

                hls.on(Hls.Events.ERROR, function (event, data) {
                    log('‚ùå Erreur HLS: ' + data.type + ' - ' + data.details, 'error');
                    if (data.fatal) {
                        showStatus('‚ùå Erreur fatale: ' + data.details, 'error');
                        switch (data.type) {
                            case Hls.ErrorTypes.NETWORK_ERROR:
                                log('‚ùå Erreur r√©seau fatale', 'error');
                                break;
                            case Hls.ErrorTypes.MEDIA_ERROR:
                                log('‚ùå Erreur m√©dia fatale', 'error');
                                break;
                            default:
                                log('‚ùå Erreur fatale non r√©cup√©rable', 'error');
                                break;
                        }
                    }
                });

            } else if (video.canPlayType('application/vnd.apple.mpegurl')) {
                log('‚úÖ Support HLS natif (Safari/iOS)', 'success');
                showStatus('‚úÖ Support HLS natif d√©tect√©', 'success');
                video.src = streamUrl;
                video.addEventListener('loadeddata', function () {
                    log('‚úÖ Vid√©o charg√©e (natif)', 'success');
                    showStatus('‚úÖ Flux charg√© avec succ√®s!', 'success');
                });
                video.play().catch(err => {
                    log('‚ö†Ô∏è Autoplay bloqu√©: ' + err.message, 'error');
                    showStatus('‚ö†Ô∏è Cliquez sur play pour d√©marrer', 'warning');
                });
            } else {
                log('‚ùå HLS non support√© sur cet appareil', 'error');
                showStatus('‚ùå HLS non support√© sur cet appareil', 'error');
            }
        }

        // Test initial
        log('üöÄ Page charg√©e');
        if (typeof Hls !== 'undefined') {
            log('‚úÖ HLS.js charg√©, version: ' + Hls.version, 'success');
            showStatus('‚úÖ HLS.js pr√™t (version ' + Hls.version + ')', 'success');
        } else {
            log('‚ùå HLS.js non charg√©', 'error');
            showStatus('‚ùå HLS.js non charg√©', 'error');
        }
    </script>
</body>

</html>